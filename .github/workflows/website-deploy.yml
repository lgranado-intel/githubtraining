name: Simple Web Application Deployment
on:
  push:
    branches:
    - main

jobs:
  deploy:
    name: Deploy to Apache Web Server on Azure
    runs-on: ubuntu-latest
    env:
      AZURE_USER: ${{ secrets.AZURE_USER }}
      AZURE_KEY: ${{ secrets.AZURE_KEY }}
      AZURE_VM: ${{ secrets.AZURE_VM}}
      ZIP_FILE: "githubtrainingwebsite.tar.gz"
      SCRIPT_FILE: "movefiles.sh"
    steps: 
    - name: Checkout the Code
      uses: actions/checkout@v2.4.2
    
    - name: Deploy Web Site
      uses: marcodallasanta/ssh-scp-deploy@v1.2.0
      with: 
        local: 'src/*'
        remote: '/tmp/src/'
        host: ${{secrets.AZURE_VM}}
        user: ${{secrets.AZURE_USER}}
        key: ${{secrets.AZURE_KEY}}
        ssh_options: -o StrictHostKeyChecking=no
        pre_upload: sudo rm -rf /var/www/html/*
        post_upload: sudo mv /tmp/src/* /var/www/html/
